<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="styles.css">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ«¡</text></svg>">
	<title>Joey Crawford</title>
</head>
<body>
	<header>
		<a href="/resume">resume</a>
		<a href="/contact">contact</a>
	</header>
	<div id="terminal">
		<div id="output"></div>
		<div id="input-line">
			<span class="prompt">visitor@joey:~$</span>
			<input type="text" id="cmd" autofocus autocomplete="off" spellcheck="false">
		</div>
	</div>
	<script type="module">
		import { commands } from './commands.js';

		const output = document.getElementById('output');
		const cmd = document.getElementById('cmd');

		async function print(content, isCommand = false) {
			const line = document.createElement('div');
			output.appendChild(line);
			if (isCommand) {
				line.className = 'cmd-line';
				line.textContent = `visitor@joey:~$ ${content}`;
			} else if (typeof content === 'object' && content.html) {
				line.innerHTML = content.html;
			} else if (typeof content === 'object' && content.text) {
				if (content.class) line.className = content.class;
				await type(line, content.text);
			} else {
				await type(line, content);
			}
			window.scrollTo(0, document.body.scrollHeight);
		}

		function type(el, text, charsPerTick = 5) {
			return new Promise(resolve => {
				let i = 0;
				const interval = setInterval(() => {
					el.textContent += text.slice(i, i + charsPerTick);
					i += charsPerTick;
					if (i >= text.length) { clearInterval(interval); resolve(); }
				}, 1);
			});
		}

		async function run(input) {
			const args = input.trim().split(/\s+/);
			const name = args[0].toLowerCase();
			if (!name) return;
			print(input, true);
			const cmd = commands[name];
			if (cmd) {
				const result = await cmd.run(args.slice(1));
				if (Array.isArray(result)) {
					for (const part of result) await print(part);
				} else if (result) {
					await print(result);
				}
			} else {
				print(`Command not found: ${name}. Type 'help' for available commands.`);
			}
		}

		cmd.addEventListener('keydown', async (e) => {
			if (e.key === 'Enter') {
				await run(cmd.value);
				cmd.value = '';
			}
		});

		document.body.addEventListener('click', (e) => {
			if (!e.target.closest('a')) cmd.focus();
		});

		run('welcome');
	</script>
</body>
</html>
